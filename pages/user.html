<div id="user">
    <br>
    <div v-if="!sessionUser">
        <form>
            <input v-model="newUser" placeholder="Enter new username">
            <input v-model="newPassword" placeholder="Enter new password">
            <button v-on:click="registerUser" class="btn btn-primary btn-sm custom-buttons">Registrieren</button>
        </form>
    </div>
    <div v-if="sessionUser">
        <h2>Eingeloggt als <i> {{ sessionUser }} </i> </h2> 
        <br><br>
        <input v-model="newGroupName" placeholder="Gruppennamen eingeben">
        <button v-on:click="createGroup" class="btn btn-outline-primary btn-sm custom-buttons">Neue Gruppe erstellen</button>
        <br><br>
        <input v-model="groupName" placeholder="Gruppennamen eingeben">
        <button v-on:click="enterGroup" class="btn btn-outline-primary btn-sm custom-buttons">Gruppe beitreten</button>
        <br><br>

        <select v-model="selectedGroup" @change="selectGroup">
            <option v-for="group in groups" v-bind:value="group">
                {{ group }}
            </option>
        </select>
        <div>
        <br>
        <button v-if="selectedGroup" v-on:click="exitGroup" class="btn btn-primary btn-sm custom-buttons">Aus aktueller Gruppe austreten</button>
        </div>

    </div>

</div>


<script>

    var userView = new Vue({
        el: '#user',
        data: {
            sessionUser: navbar.sessionUser,
            newUser: '',
            newPassword: '',
            newGroup: '',
            groupName: '',
            newGroupName: '',
            selectedGroup: navbar.selectedGroup,
            groups: []
        },
        methods: {
            registerUser: function () {
                var newUser = userView.newUser;
                var newPassword = userView.newPassword;

                if(newUser != '' && newPassword != '') {
                    console.log(newUser);
                    $.post("/api/user", {username: newUser, password: newPassword}, function(result){
                        notify("saved: " + result);
                    });
                }
            },
            createGroup: function() {
                var newGroup = userView.newGroupName.trim();
                if(newGroup != '') {
                    $.post("/api/createGroup", {groupName: newGroup}, function(result){
                        userView.getGroupsOfSessionUser();
                        notify("CreateGroup: " + result);
                    });
                }
            },
            enterGroup: function() {
                var existingGroup = userView.groupName.trim();

                if(existingGroup != '') {
                    $.post("/api/enterGroup", {groupName: existingGroup}, function(result){
                        userView.getGroupsOfSessionUser();
                        notify("EnterGroup: " + result);
                    });
                }
            },
            exitGroup: function() {
                $.post("/api/exitGroup", {}, function(result){
                    notify("ExitGroup: " + result);
                });
                navbar.selectedGroup = "";
                userView.selectedGroup = "";
            },
            getGroupsOfSessionUser: function() {
                $.post("/api/getGroupsOfUser", {}, function(result){
                    userView.groups = result;
                });
            },
            selectGroup: function() {
                $.post("/api/selectGroup", {selectedGroup: userView.selectedGroup}, function(result){
                    navbar.selectedGroup = userView.selectedGroup;
                    indexSite.loadMessages();
                    // if successful:
                    leaveSocket();
                    joinSocket(userView.selectedGroup);
                });
            }

        }
    })

    if(navbar.sessionUser != null && navbar.sessionUser != '') {
        userView.getGroupsOfSessionUser();
    }

</script>